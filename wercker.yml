box: bringnow/android-sdk
no-response-timeout: 30
command-timeout: 60

build:
  steps:
    - npm-install
    - script:
      name: flow
      code: npm run flow
    - script:
      name: eslint
      code: npm run lint
    - script:
      name: npm-test
      code: npm test -- --coverage
    - script:
      name: save-artifacts
      code: cp -r coverage $WERCKER_REPORT_ARTIFACTS_DIR/coverage
    - script:
      name: echo nodejs information
      code: |
        echo "node version $(node -v) running"
        echo "npm version $(npm -v) running"
  after-steps:
    - slack-notifier:
      url: $SLACK_URL
      username: wercker-ci
    - script:
      name: slack-notify-coverage
      code: node slack-istanbul.js

deploy-debug:
  steps:
    - create-file:
      name: Create crashlytics.properties
      filename: android/app/crashlytics.properties
      overwrite: true
      content: |-
        apiKey=$FABRIC_API_KEY
        apiSecret=$FABRIC_BUILD_SECRET
    - script:
      name: Build app and Deploy to Fabric
      cwd: android
      code: ./gradlew assembleDebug -PbundleInDebug=true -PversionName="$(git describe | sed -e 's/^v//')" crashlyticsUploadDistributionDebug
